<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>PRO-SCOUT V8 | Sorunsuz Sistem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --neon: #00ff88; --pitch: #0a0f16; }
        body { background: #030508; color: #e2e8f0; font-family: sans-serif; overflow: hidden; }
        
        /* SAHA TASARIMI */
        .pitch-container { 
            background: var(--pitch); border: 3px solid #1f2937; position: relative; 
            height: 700px; width: 100%; border-radius: 20px;
            background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* POZİSYON KUTULARI (DROP ZONE) */
        .drop-zone {
            position: absolute; width: 80px; height: 90px;
            border: 1px dashed rgba(0, 255, 136, 0.3); border-radius: 10px;
            transform: translate(-50%, -50%); display: flex; flex-direction: column;
            align-items: center; justify-content: center; transition: 0.3s;
        }
        .drop-zone.hover { background: rgba(0, 255, 136, 0.1); border-color: var(--neon); }

        /* OYUNCU KARTI (DRAGGABLE) */
        .player-chip {
            background: #161b22; border: 1px solid #30363d; padding: 6px;
            border-radius: 8px; cursor: grab; width: 100%; font-size: 10px;
            text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .player-chip:active { cursor: grabbing; }
        
        .scout-item {
            background: #0d1117; border: 1px solid #1f2937; padding: 10px;
            border-radius: 8px; cursor: grab; margin-bottom: 8px; transition: 0.2s;
        }
        .scout-item:hover { border-color: var(--neon); }

        .active-btn { background: var(--neon) !important; color: #000 !important; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-[1600px] mx-auto">
        <header class="flex justify-between items-center mb-4 bg-[#0d1117] p-4 rounded-xl border border-gray-800">
            <div class="flex items-center gap-4">
                <h1 class="text-xl font-black text-[var(--neon)]">SCOUT V8</h1>
                <div class="flex gap-1 bg-black p-1 rounded-lg">
                    <button onclick="setPhase('toplu')" id="btn-toplu" class="active-btn px-4 py-1 text-[10px] rounded uppercase font-bold">Toplu Alan</button>
                    <button onclick="setPhase('topsuz')" id="btn-topsuz" class="px-4 py-1 text-[10px] rounded uppercase font-bold text-gray-400">Topsuz Alan</button>
                </div>
            </div>
            
            <div class="flex gap-2">
                <input id="manName" type="text" placeholder="Oyuncu İsmi..." class="bg-gray-900 border border-gray-700 text-xs p-2 rounded w-48 outline-none focus:border-green-500">
                <button onclick="addManual()" class="bg-white text-black font-bold px-4 rounded text-xs">MANUEL EKLE</button>
                <button onclick="fetchWiki()" id="wikiBtn" class="bg-[var(--neon)] text-black font-bold px-4 rounded text-xs">OYUNCU ÖNER</button>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-6">
            <div class="col-span-3">
                <h3 class="text-[10px] font-bold text-gray-500 mb-4 uppercase tracking-widest">Wikipedia Canlı Akış</h3>
                <div id="results" class="h-[700px] overflow-y-auto pr-2">
                    <p class="text-xs text-gray-600 italic">"Oyuncu Öner" butonuna basarak canlı verileri çekin.</p>
                </div>
            </div>

            <div class="col-span-9">
                <div class="pitch-container" id="pitch">
                    </div>
            </div>
        </div>
    </div>

    <script>
        const phases = {
            toplu: [
                { id: 0, pos: "KL", t: 90, l: 50 }, { id: 1, pos: "STP", t: 78, l: 38 }, { id: 2, pos: "STP", t: 78, l: 62 },
                { id: 3, pos: "SLB", t: 60, l: 15 }, { id: 4, pos: "SĞB", t: 60, l: 85 }, { id: 5, pos: "MO", t: 65, l: 50 },
                { id: 6, pos: "MO", t: 45, l: 30 }, { id: 7, pos: "MO", t: 45, l: 70 }, { id: 8, pos: "SLK", t: 25, l: 12 },
                { id: 9, pos: "SĞK", t: 25, l: 88 }, { id: 10, pos: "SNT", t: 15, l: 50 }
            ],
            topsuz: [
                { id: 0, pos: "KL", t: 92, l: 50 }, { id: 1, pos: "STP", t: 82, l: 44 }, { id: 2, pos: "STP", t: 82, l: 56 },
                { id: 3, pos: "SLB", t: 80, l: 20 }, { id: 4, pos: "SĞB", t: 80, l: 80 }, { id: 5, pos: "MO", t: 72, l: 50 },
                { id: 6, pos: "MO", t: 68, l: 35 }, { id: 7, pos: "MO", t: 68, l: 65 }, { id: 8, pos: "SLK", t: 55, l: 25 },
                { id: 9, pos: "SĞK", t: 55, l: 75 }, { id: 10, pos: "SNT", t: 45, l: 50 }
            ]
        };

        let currentPhase = 'toplu';
        let squadData = Array(11).fill(null);
        let seenNames = new Set();

        // SAHAYI ÇİZ
        function renderPitch() {
            const pitch = document.getElementById('pitch');
            pitch.innerHTML = ""; // Temizle
            
            phases[currentPhase].forEach((slot, index) => {
                const zone = document.createElement('div');
                zone.className = 'drop-zone';
                zone.style.top = slot.t + '%';
                zone.style.left = slot.l + '%';
                zone.innerHTML = `<span class="text-[9px] text-gray-600 mb-1">${slot.pos}</span>`;
                
                // Drop olayları
                zone.ondragover = (e) => { e.preventDefault(); zone.classList.add('hover'); };
                zone.ondragleave = () => zone.classList.remove('hover');
                zone.ondrop = (e) => {
                    e.preventDefault();
                    zone.classList.remove('hover');
                    const data = JSON.parse(e.dataTransfer.getData("player"));
                    squadData[index] = data;
                    renderPitch();
                };

                // Eğer içinde oyuncu varsa
                if(squadData[index]) {
                    const p = squadData[index];
                    zone.innerHTML += `
                        <div class="player-chip">
                            <div class="font-bold text-white truncate">${p.name.split(' ')[0]}</div>
                            <div class="text-[7px] text-green-500">${p.goals} G / ${p.matches} M</div>
                            <div class="text-[6px] text-red-500 mt-1 cursor-pointer" onclick="removePlayer(${index})">KALDIR</div>
                        </div>`;
                }
                pitch.appendChild(zone);
            });
        }

        // WIKIPEDIA'DAN ÇEK
        async function fetchWiki() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="text-xs animate-pulse text-green-500">Wikipedia taranıyor...</div>';
            
            const sparql = `
                SELECT DISTINCT ?name ?teamName ?goals ?matches ?desc WHERE {
                    ?player a <http://dbpedia.org/ontology/SoccerPlayer> ;
                            <http://xmlns.com/foaf/0.1/name> ?name ;
                            <http://dbpedia.org/ontology/team> ?team ;
                            <http://dbpedia.org/ontology/abstract> ?desc .
                    ?team <http://xmlns.com/foaf/0.1/name> ?teamName .
                    OPTIONAL { ?player <http://dbpedia.org/ontology/goals> ?goals }
                    OPTIONAL { ?player <http://dbpedia.org/ontology/statMatches> ?matches }
                    FILTER (LANG(?desc) = "en")
                } LIMIT 60`;

            try {
                const response = await fetch("https://dbpedia.org/sparql?query=" + encodeURIComponent(sparql) + "&format=json");
                const data = await response.json();
                results.innerHTML = "";

                data.results.bindings.forEach(p => {
                    const name = p.name.value;
                    const team = p.teamName.value;
                    const goals = p.goals ? p.goals.value : "0";
                    const matches = p.matches ? p.matches.value : "0";

                    // FİLTRELEME: Boş isimleri ve az maç oynayanları ele
                    if(seenNames.has(name) || matches < 5 || name.length < 3) return;

                    const item = document.createElement('div');
                    item.className = 'scout-item';
                    item.draggable = true;
                    item.innerHTML = `
                        <div class="flex justify-between">
                            <span class="text-[11px] font-bold text-white">${name}</span>
                            <span class="text-[9px] text-green-500 font-mono">${goals} G</span>
                        </div>
                        <div class="text-[9px] text-gray-500">${team} | ${matches} Maç</div>
                    `;

                    item.ondragstart = (e) => {
                        e.dataTransfer.setData("player", JSON.stringify({name, team, goals, matches}));
                    };

                    results.appendChild(item);
                    seenNames.add(name);
                });
            } catch (e) { results.innerHTML = "Veri çekilemedi. Lütfen tekrar deneyin."; }
        }

        function setPhase(p) {
            currentPhase = p;
            document.getElementById('btn-toplu').className = p === 'toplu' ? 'active-btn px-4 py-1 text-[10px] rounded uppercase font-bold' : 'px-4 py-1 text-[10px] rounded uppercase font-bold text-gray-400';
            document.getElementById('btn-topsuz').className = p === 'topsuz' ? 'active-btn px-4 py-1 text-[10px] rounded uppercase font-bold' : 'px-4 py-1 text-[10px] rounded uppercase font-bold text-gray-400';
            renderPitch();
        }

        function removePlayer(idx) {
            squadData[idx] = null;
            renderPitch();
        }

        function addManual() {
            const name = document.getElementById('manName').value;
            if(!name) return;
            // İlk boş yere ekle
            const emptyIdx = squadData.indexOf(null);
            if(emptyIdx !== -1) {
                squadData[emptyIdx] = { name, team: "Manuel", goals: "-", matches: "-" };
                renderPitch();
                document.getElementById('manName').value = "";
            } else {
                alert("Kadro dolu!");
            }
        }

        // Başlangıç
        renderPitch();
    </script>
</body>
</html>
