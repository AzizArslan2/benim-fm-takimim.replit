<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>FM Scout AI - Pro Scouter</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Quantico:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --main-blue: #00d4ff; --dark-bg: #030712; }
        body { 
            font-family: 'Quantico', sans-serif; 
            background-color: var(--dark-bg); 
            color: #f1f5f9; 
        }
        .header-font { font-family: 'Audiowide', cursive; }
        
        /* Taktik Saha */
        .football-pitch { 
            background: linear-gradient(to bottom, #0f172a, #020617);
            border: 2px solid #1e293b; position: relative; height: 550px;
            border-radius: 24px; box-shadow: 0 0 30px rgba(0, 212, 255, 0.1);
        }
        .pos-marker { 
            position: absolute; width: 45px; height: 32px; transform: translate(-50%, -50%);
            background: #1e293b; border: 1px solid var(--main-blue);
            color: var(--main-blue); font-size: 10px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s; clip-path: polygon(0 0, 100% 0, 85% 100%, 15% 100%);
        }
        .pos-marker:hover, .pos-marker.active { 
            background: var(--main-blue); color: #000; box-shadow: 0 0 15px var(--main-blue);
        }

        /* Liste ve Kartlar */
        .player-row { 
            background: rgba(30, 41, 59, 0.4); 
            border: 1px solid #334155; border-radius: 12px;
            transition: 0.3s;
        }
        .player-row:hover { border-color: var(--main-blue); transform: scale(1.01); }
        .stat-value { font-family: 'Audiowide', cursive; color: #fff; }
        
        select, input { background: #0f172a !important; border: 1px solid #334155 !important; color: white !important; }
    </style>
</head>
<body class="p-6">

    <div class="max-w-[1400px] mx-auto">
        <header class="flex flex-col lg:flex-row justify-between items-center mb-8 border-b border-slate-800 pb-6 gap-4">
            <div>
                <h1 class="header-font text-3xl text-cyan-400 tracking-wider">SCOUT ENGINE v6</h1>
                <p class="text-[10px] text-slate-500 tracking-[0.5em] uppercase mt-1 text-center lg:text-left">No Hidden Characters - Pure Data Mode</p>
            </div>
            
            <div class="flex flex-wrap gap-3 justify-center">
                <div class="flex flex-col">
                    <label class="text-[9px] uppercase font-bold text-slate-500 mb-1">Lig Seçimi</label>
                    <select id="leagueID" class="p-2 rounded text-xs w-48 outline-none focus:border-cyan-400">
                        <option value="39">Ingiltere: Premier League</option>
                        <option value="40">Ingiltere: Championship</option>
                        <option value="203">Turkiye: Super Lig</option>
                        <option value="140">Ispanya: La Liga</option>
                        <option value="78">Almanya: Bundesliga</option>
                        <option value="135">Italya: Serie A</option>
                        <option value="61">Fransa: Ligue 1</option>
                        <option value="71">Brezilya: Serie A</option>
                        <option value="94">Portekiz: Primeira Liga</option>
                        <option value="88">Hollanda: Eredivisie</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label class="text-[9px] uppercase font-bold text-slate-500 mb-1">Yas Limiti</label>
                    <input id="ageMax" type="number" value="23" class="p-2 rounded text-xs w-16 outline-none focus:border-cyan-400">
                </div>
                <button onclick="runGlobalScout()" class="bg-cyan-600 hover:bg-cyan-500 text-black px-8 rounded font-bold text-xs transition-all self-end h-[34px]">ANALIZI BASLAT</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-5">
                <div class="football-pitch">
                    <button onclick="setSearch('Goalkeeper', 'GK', this)" class="pos-marker" style="top: 92%; left: 50%;">GK</button>
                    <button onclick="setSearch('Defender', 'DC', this)" class="pos-marker" style="top: 78%; left: 50%;">DC</button>
                    <button onclick="setSearch('Defender', 'DL', this)" class="pos-marker" style="top: 75%; left: 18%;">DL</button>
                    <button onclick="setSearch('Defender', 'DR', this)" class="pos-marker" style="top: 75%; left: 82%;">DR</button>
                    <button onclick="setSearch('Midfielder', 'MC', this)" class="pos-marker" style="top: 55%; left: 50%;">MC</button>
                    <button onclick="setSearch('Attacker', 'LW', this)" class="pos-marker" style="top: 25%; left: 18%;">LW</button>
                    <button onclick="setSearch('Attacker', 'RW', this)" class="pos-marker" style="top: 25%; left: 82%;">RW</button>
                    <button onclick="setSearch('Attacker', 'ST', this)" class="pos-marker active" style="top: 12%; left: 50%;">ST</button>
                </div>
            </div>

            <div class="lg:col-span-7 h-[550px] overflow-y-auto pr-4 custom-scroll">
                <div id="statusMsg" class="hidden text-center py-20 text-cyan-400 font-bold tracking-widest animate-pulse uppercase text-xs">Veri Tabanina Baglaniliyor...</div>
                <div id="resultsGrid" class="grid grid-cols-1 gap-3">
                    </div>
            </div>
        </div>
    </div>

    <script>
        const KEY = 'bbf2c8b42d6e26a65670f5863d75aab5';
        let currentPos = 'ST'; 

        function setSearch(type, short, btn) {
            currentPos = short;
            document.querySelectorAll('.pos-marker').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        async function runGlobalScout() {
            const league = document.getElementById('leagueID').value;
            const ageLimit = document.getElementById('ageMax').value;
            const grid = document.getElementById('resultsGrid');
            const msg = document.getElementById('statusMsg');

            grid.innerHTML = '';
            msg.classList.remove('hidden');

            try {
                const res = await axios.get('https://v3.football.api-sports.io/players', {
                    params: { league: league, season: 2024 },
                    headers: { 'x-apisports-key': KEY }
                });

                msg.classList.add('hidden');
                
                // --- AKILLI ROL AYRISTIRMA ---
                const rawPlayers = res.data.response;
                
                let filtered = rawPlayers.filter(item => {
                    const s = item.statistics[0];
                    const p = item.player;
                    
                    if (p.age > ageLimit) return false;

                    // Mevki Kontrolü
                    const apiPos = s.games.position;
                    if (currentPos === 'ST') return apiPos === 'Attacker' && (s.goals.total > 0 || s.shots.on > 0);
                    if (currentPos === 'LW' || currentPos === 'RW') return (apiPos === 'Attacker' || apiPos === 'Midfielder') && (s.goals.assists > 0 || s.passes.key > 0);
                    if (currentPos === 'GK') return apiPos === 'Goalkeeper';
                    if (currentPos === 'DC' || currentPos === 'DL' || currentPos === 'DR') return apiPos === 'Defender';
                    if (currentPos === 'MC') return apiPos === 'Midfielder';
                    
                    return apiPos.includes(s.games.position);
                });

                filtered.slice(0, 12).forEach(p => drawCard(p.player, p.statistics[0]));

            } catch (err) { msg.classList.add('hidden'); console.error(err); }
        }

        function drawCard(p, s) {
            const goals = s.goals.total || 0;
            const assists = s.goals.assists || 0;
            const rating = parseFloat(s.games.rating || 0).toFixed(1);
            const score = Math.round((rating * 10) + (p.age < 22 ? 8 : 0));

            document.getElementById('resultsGrid').innerHTML += `
                <div class="player-row p-4 flex flex-col md:flex-row items-center gap-4">
                    <img src="${p.photo}" class="w-12 h-12 rounded-lg border border-slate-700">
                    <div class="flex-1 min-w-0 text-center md:text-left">
                        <h3 class="font-bold text-sm text-white truncate uppercase">${p.name}</h3>
                        <p class="text-[9px] text-cyan-500 font-bold tracking-wider">${s.team.name} | ${p.age} YAS</p>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-2 w-full md:w-auto text-center border-l border-slate-700 pl-4">
                        <div class="px-2">
                            <p class="text-[8px] text-slate-500 font-bold mb-1">GOL</p>
                            <p class="stat-value text-sm">${goals}</p>
                        </div>
                        <div class="px-2">
                            <p class="text-[8px] text-slate-500 font-bold mb-1">AST</p>
                            <p class="stat-value text-sm text-cyan-400">${assists}</p>
                        </div>
                        <div class="px-2">
                            <p class="text-[8px] text-slate-500 font-bold mb-1">FORM</p>
                            <p class="stat-value text-sm text-yellow-500">${rating}</p>
                        </div>
                        <div class="px-2">
                            <p class="text-[8px] text-slate-500 font-bold mb-1">SCORE</p>
                            <p class="stat-value text-sm text-white">${score}</p>
                        </div>
                    </div>
                </div>`;
        }
    </script>
</body>
</html>
