<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>PRO-SCOUT V7 | Drag & Drop + Smart Filter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --neon: #00ff88; --bg: #030508; }
        body { background: var(--bg); color: #e2e8f0; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        .pitch { 
            background: #080a0f; border: 2px solid #1f2937; position: relative; height: 750px; width: 100%; border-radius: 20px;
            background-image: radial-gradient(circle, #1a1d23 1px, transparent 1px); background-size: 40px 40px;
        }

        .player-node { 
            position: absolute; cursor: grab; z-index: 50;
            width: 80px; text-align: center; transform: translate(-50%, -50%);
        }
        .player-node:active { cursor: grabbing; }

        .node-dot { 
            width: 38px; height: 38px; margin: 0 auto; background: #000; border: 2px solid var(--neon); 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 900;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
        }

        .scout-card { 
            background: #0d1117; border: 1px solid #1f2937; padding: 12px; border-radius: 10px; margin-bottom: 8px;
            cursor: pointer; transition: 0.2s;
        }
        .scout-card:hover { border-color: var(--neon); background: #161b22; }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 9px; margin-top: 5px; color: #888; }
        .active-phase { background: var(--neon) !important; color: #000 !important; }
        
        #results::-webkit-scrollbar { width: 4px; }
        #results::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-full mx-auto">
        <header class="flex justify-between items-center mb-4 bg-[#0d1117] p-4 rounded-xl border border-gray-800">
            <div class="flex items-center gap-6">
                <h1 class="text-xl font-black italic text-white">SCOUT <span class="text-[var(--neon)]">V7</span></h1>
                <div class="flex gap-1 bg-black p-1 rounded-lg border border-gray-800">
                    <button onclick="setPhase('toplu')" id="btnToplu" class="px-3 py-1 text-[10px] rounded active-phase uppercase font-bold">Toplu</button>
                    <button onclick="setPhase('topsuz')" id="btnTopsuz" class="px-3 py-1 text-[10px] rounded uppercase font-bold text-gray-500">Topsuz</button>
                </div>
            </div>
            
            <div class="flex gap-2">
                <input id="manName" type="text" placeholder="İsim" class="bg-gray-900 border border-gray-700 text-[10px] p-2 rounded w-32 outline-none focus:border-green-500">
                <button onclick="addManual()" class="bg-white text-black font-bold px-4 rounded text-[10px] hover:bg-gray-200">EKLE</button>
                <button onclick="fetchWiki()" id="wikiBtn" class="bg-[var(--neon)] text-black font-bold px-4 rounded text-[10px] hover:opacity-80">WIKI TARAMA</button>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-6">
            <div class="col-span-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-[10px] font-bold text-gray-500 uppercase">Akıllı Filtreleme Aktif</h3>
                    <span id="loading" class="hidden text-[10px] text-green-500 animate-pulse font-mono">TARANIYOR...</span>
                </div>
                <div id="results" class="h-[750px] overflow-y-auto pr-2 space-y-2">
                    <p class="text-[11px] text-gray-600 italic text-center py-10">Düşük özellikli ve boş oyuncular otomatik olarak ayıklanacaktır.</p>
                </div>
            </div>

            <div class="col-span-9 relative">
                <div class="pitch" id="pitchContainer" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div id="pitchContent"></div>
                </div>
                
                <div class="absolute bottom-4 left-4 right-4 bg-black/60 backdrop-blur-md border border-gray-800 p-4 rounded-xl flex gap-4 overflow-x-auto" id="bench">
                    <p class="text-[10px] text-gray-500 uppercase mt-2">Yedek Kulübesi (Buraya Sürükle)</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // FAZ KOORDİNATLARI
        const phases = {
            toplu: [ 
                {p: "KL", t: 90, l: 50}, {p: "STP", t: 78, l: 40}, {p: "STP", t: 78, l: 60},
                {p: "SLB", t: 55, l: 15}, {p: "SĞB", t: 55, l: 85}, {p: "MO", t: 60, l: 50},
                {p: "MO", t: 45, l: 30}, {p: "MO", t: 45, l: 70}, {p: "SLK", t: 20, l: 15},
                {p: "SĞK", t: 20, l: 85}, {p: "SNT", t: 10, l: 50}
            ],
            topsuz: [
                {p: "KL", t: 92, l: 50}, {p: "STP", t: 82, l: 45}, {p: "STP", t: 82, l: 55},
                {p: "SLB", t: 80, l: 25}, {p: "SĞB", t: 80, l: 75}, {p: "MO", t: 72, l: 50},
                {p: "MO", t: 68, l: 40}, {p: "MO", t: 68, l: 60}, {p: "SLK", t: 60, l: 30},
                {p: "SĞK", t: 60, l: 70}, {p: "SNT", t: 50, l: 50}
            ]
        };

        let currentPhase = 'toplu';
        let squad = Array(11).fill(null);
        let seen = new Set();

        async function fetchWiki() {
            const resDiv = document.getElementById('results');
            const loading = document.getElementById('loading');
            loading.classList.remove('hidden');
            
            const query = `
                SELECT DISTINCT ?name ?teamName ?goals ?matches ?desc WHERE {
                    ?player a <http://dbpedia.org/ontology/SoccerPlayer> ;
                            <http://xmlns.com/foaf/0.1/name> ?name ;
                            <http://dbpedia.org/ontology/team> ?team ;
                            <http://dbpedia.org/ontology/abstract> ?desc .
                    ?team <http://xmlns.com/foaf/0.1/name> ?teamName .
                    OPTIONAL { ?player <http://dbpedia.org/ontology/goals> ?goals }
                    OPTIONAL { ?player <http://dbpedia.org/ontology/statMatches> ?matches }
                    FILTER (LANG(?desc) = "en")
                } LIMIT 50`;

            try {
                const response = await fetch("https://dbpedia.org/sparql?query=" + encodeURIComponent(query) + "&format=json");
                const data = await response.json();
                resDiv.innerHTML = "";
                
                data.results.bindings.forEach(p => {
                    const name = p.name.value;
                    const team = p.teamName.value;
                    const goals = p.goals ? parseInt(p.goals.value) : 0;
                    const matches = p.matches ? parseInt(p.matches.value) : 0;
                    const desc = p.desc.value.toLowerCase();

                    // AKILLI AYIKLAMA (Boş ve gereksiz oyuncuları filtrele)
                    if(seen.has(name) || name.length < 3 || matches < 5) return;

                    // MEVKİ ÖZELLİK ANALİZİ (Wikipedia özetinden özellik çekme)
                    let skill = "Genel";
                    let score = Math.floor(Math.random() * 20) + 70; // Simülasyon puanı
                    if(desc.includes("pace") || desc.includes("dribbling")) skill = "Hız/Dribling";
                    if(desc.includes("tackle") || desc.includes("strong")) skill = "Güç/Müdahale";
                    if(desc.includes("passing") || desc.includes("playmaker")) skill = "Pas/Vizyon";

                    resDiv.innerHTML += `
                        <div class="scout-card" draggable="true" ondragstart="drag(event, '${name}', '${team}', '${goals}', '${matches}', '${skill}')">
                            <div class="flex justify-between items-start">
                                <p class="text-[11px] font-black uppercase text-white">${name}</p>
                                <span class="text-[9px] text-green-500 font-bold">${score}</span>
                            </div>
                            <p class="text-[9px] text-gray-500">${team}</p>
                            <div class="stat-grid">
                                <span>Maç: ${matches}</span>
                                <span>Gol: ${goals}</span>
                                <span class="col-span-2 text-[var(--neon)]">Özellik: ${skill}</span>
                            </div>
                        </div>`;
                    seen.add(name);
                });
            } catch (e) { console.error(e); } finally { loading.classList.add('hidden'); }
        }

        // DRAG & DROP LOGIC
        function allowDrop(ev) { ev.preventDefault(); }

        function drag(ev, name, team, goals, matches, skill) {
            const data = { name, team, goals, matches, skill };
            ev.dataTransfer.setData("player", JSON.stringify(data));
        }

        function drop(ev) {
            ev.preventDefault();
            const data = JSON.parse(ev.dataTransfer.getData("player"));
            
            // Mouse koordinatlarını alıp en yakın slota yerleştirme
            const rect = document.getElementById('pitchContainer').getBoundingClientRect();
            const xPC = ((ev.clientX - rect.left) / rect.width) * 100;
            const yPC = ((ev.clientY - rect.top) / rect.height) * 100;

            // En yakın boş slotu bul
            let closestIdx = 0;
            let minDist = 1000;
            phases[currentPhase].forEach((pos, i) => {
                let dist = Math.sqrt(Math.pow(pos.l - xPC, 2) + Math.pow(pos.t - yPC, 2));
                if(dist < minDist) { minDist = dist; closestIdx = i; }
            });

            squad[closestIdx] = data;
            renderPitch();
        }

        function renderPitch() {
            const container = document.getElementById('pitchContent');
            container.innerHTML = "";
            phases[currentPhase].forEach((pos, i) => {
                const player = squad[i];
                const div = document.createElement('div');
                div.className = "player-node";
                div.style.top = pos.t + "%";
                div.style.left = pos.l + "%";
                div.innerHTML = `
                    <div class="node-dot" onclick="removePlayer(${i})"><span>${pos.p}</span></div>
                    <div class="text-[9px] font-bold mt-1 text-white truncate w-20">${player ? player.name.split(' ')[0] : '---'}</div>
                    ${player ? `<div class="text-[7px] text-green-500">${player.skill.split('/')[0]}</div>` : ''}
                `;
                container.appendChild(div);
            });
        }

        function setPhase(p) {
            currentPhase = p;
            document.getElementById('btnToplu').classList.toggle('active-phase', p === 'toplu');
            document.getElementById('btnTopsuz').classList.toggle('active-phase', p === 'topsuz');
            renderPitch();
        }

        function removePlayer(i) {
            squad[i] = null;
            renderPitch();
        }

        function addManual() {
            const name = document.getElementById('manName').value;
            if(!name) return;
            const data = { name, team: "Manuel", goals: "-", matches: "-", skill: "Genel" };
            // İlk boş yere koy
            const idx = squad.indexOf(null);
            if(idx !== -1) squad[idx] = data;
            renderPitch();
            document.getElementById('manName').value = "";
        }

        renderPitch();
    </script>
</body>
</html>
