<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>PRO-SCOUT V9 | Kararlı Sürüm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --neon: #00ff88; --bg: #030508; }
        body { background: var(--bg); color: #e2e8f0; font-family: 'Inter', sans-serif; }
        
        .pitch { 
            background: #080a0f; border: 2px solid #1f2937; position: relative; height: 650px; width: 100%; border-radius: 20px;
            background-image: radial-gradient(circle, #1a1d23 1px, transparent 1px); background-size: 40px 40px;
        }

        .pos-slot {
            position: absolute; width: 70px; height: 70px; border: 1px solid #1f2937; border-radius: 50%;
            transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.4); cursor: pointer; transition: 0.3s;
        }
        .pos-slot:hover { border-color: var(--neon); background: rgba(0, 255, 136, 0.05); }
        .slot-active { border-color: var(--neon); box-shadow: 0 0 15px rgba(0, 255, 136, 0.2); }

        .scout-card {
            background: #0d1117; border: 1px solid #1f2937; padding: 10px; border-radius: 8px; margin-bottom: 8px;
            cursor: pointer; border-left: 3px solid transparent;
        }
        .scout-card:hover { border-left-color: var(--neon); background: #161b22; }
        .selected-player { border-left-color: var(--neon); background: #1a2333; }

        .btn-active { background: var(--neon) !important; color: #000 !important; }
    </style>
</head>
<body class="p-6">

    <div class="max-w-[1500px] mx-auto">
        <header class="flex justify-between items-center mb-6 bg-[#0d1117] p-6 rounded-xl border border-gray-800">
            <div class="flex items-center gap-6">
                <h1 class="text-xl font-black italic text-white">SCOUT <span class="text-[var(--neon)]">V9</span></h1>
                <div class="flex gap-2">
                    <button onclick="setPhase('toplu')" id="btn-toplu" class="btn-active text-[10px] font-bold px-4 py-2 rounded border border-gray-700">TOPLU ALAN</button>
                    <button onclick="setPhase('topsuz')" id="btn-topsuz" class="text-[10px] font-bold px-4 py-2 rounded border border-gray-700">TOPSUZ ALAN</button>
                </div>
            </div>
            
            <div class="flex gap-3">
                <input id="manName" type="text" placeholder="Manuel İsim..." class="bg-gray-900 border border-gray-700 text-xs p-2 rounded outline-none focus:border-green-500">
                <button onclick="addManual()" class="bg-white text-black font-bold px-4 rounded text-xs">EKLE</button>
                <button onclick="fetchWiki()" id="wikiBtn" class="bg-[var(--neon)] text-black font-bold px-4 rounded text-xs">OYUNCU ÖNER</button>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-8">
            <div class="col-span-3">
                <h3 class="text-[10px] font-bold text-gray-500 mb-4 uppercase">Canlı Yayın / Filtrelenmiş</h3>
                <div id="results" class="max-h-[600px] overflow-y-auto pr-2 space-y-2">
                    <p class="text-xs text-gray-600 italic text-center py-10">Veri bekliyor...</p>
                </div>
            </div>

            <div class="col-span-9 relative">
                <div class="pitch" id="pitch">
                    </div>
                <div class="mt-4 text-[10px] text-gray-500 text-center">
                    Kullanım: Önce soldan bir **oyuncuya tıkla**, sonra sahadaki bir **mevkiye tıkla**.
                </div>
            </div>
        </div>
    </div>

    <script>
        const phases = {
            toplu: [ 
                {pos: "KL", t: 90, l: 50}, {pos: "STP", t: 78, l: 40}, {pos: "STP", t: 78, l: 60},
                {pos: "SLB", t: 60, l: 15}, {pos: "SĞB", t: 60, l: 85}, {pos: "MO", t: 65, l: 50},
                {pos: "MO", t: 45, l: 30}, {pos: "MO", t: 45, l: 70}, {pos: "SLK", t: 25, l: 15},
                {pos: "SĞK", t: 25, l: 85}, {pos: "SNT", t: 15, l: 50}
            ],
            topsuz: [
                {pos: "KL", t: 92, l: 50}, {pos: "STP", t: 82, l: 45}, {pos: "STP", t: 82, l: 55},
                {pos: "SLB", t: 80, l: 25}, {pos: "SĞB", t: 80, l: 75}, {pos: "MO", t: 72, l: 50},
                {pos: "MO", t: 68, l: 38}, {pos: "MO", t: 68, l: 62}, {pos: "SLK", t: 55, l: 30},
                {pos: "SĞK", t: 55, l: 70}, {pos: "SNT", t: 45, l: 50}
            ]
        };

        let squad = Array(11).fill(null);
        let currentPhase = 'toplu';
        let selectedPlayerData = null;

        // WIKIPEDIA FETCH (Akıllı Ayıklama ile)
        async function fetchWiki() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="text-xs animate-pulse text-green-500">Wikipedia Veritabanı Taranıyor...</div>';
            
            const sparql = `
                SELECT DISTINCT ?name ?teamName ?goals ?matches WHERE {
                    ?player a <http://dbpedia.org/ontology/SoccerPlayer> ;
                            <http://xmlns.com/foaf/0.1/name> ?name ;
                            <http://dbpedia.org/ontology/team> ?team .
                    ?team <http://xmlns.com/foaf/0.1/name> ?teamName .
                    ?player <http://dbpedia.org/ontology/goals> ?goals .
                    ?player <http://dbpedia.org/ontology/statMatches> ?matches .
                    FILTER (?goals > 5)
                } LIMIT 50`;

            try {
                const response = await fetch("https://dbpedia.org/sparql?query=" + encodeURIComponent(sparql) + "&format=json");
                const data = await response.json();
                results.innerHTML = "";

                data.results.bindings.forEach((p, i) => {
                    const name = p.name.value;
                    const team = p.teamName.value;
                    const goals = p.goals.value;
                    const matches = p.matches.value;

                    // Ayıklama: Sadece ismi olan ve gol atanları getir
                    if(name.includes("http") || name.length < 3) return;

                    const card = document.createElement('div');
                    card.className = 'scout-card';
                    card.id = 'player-' + i;
                    card.innerHTML = `
                        <p class="text-[11px] font-bold text-white uppercase">${name}</p>
                        <p class="text-[9px] text-gray-500">${team}</p>
                        <p class="text-[8px] text-green-500 mt-1 font-mono">${matches} Maç / ${goals} Gol</p>
                    `;
                    card.onclick = () => selectPlayer(card, {name, team, goals, matches});
                    results.appendChild(card);
                });
            } catch (e) { results.innerHTML = "Veri çekilemedi."; }
        }

        function selectPlayer(el, data) {
            document.querySelectorAll('.scout-card').forEach(c => c.classList.remove('selected-player'));
            el.classList.add('selected-player');
            selectedPlayerData = data;
        }

        function renderPitch() {
            const pitch = document.getElementById('pitch');
            pitch.innerHTML = "";
            phases[currentPhase].forEach((slot, i) => {
                const player = squad[i];
                const div = document.createElement('div');
                div.className = `pos-slot ${player ? 'slot-active' : ''}`;
                div.style.top = slot.t + "%";
                div.style.left = slot.l + "%";
                
                div.innerHTML = `
                    <span class="text-[8px] text-gray-500 font-bold mb-1">${slot.pos}</span>
                    <span class="text-[9px] font-black text-white text-center px-1">${player ? player.name.split(' ')[0] : ''}</span>
                    ${player ? `<span class="text-[7px] text-green-500">${player.goals} G</span>` : ''}
                `;

                div.onclick = () => {
                    if(selectedPlayerData) {
                        squad[i] = selectedPlayerData;
                        selectedPlayerData = null;
                        document.querySelectorAll('.scout-card').forEach(c => c.classList.remove('selected-player'));
                        renderPitch();
                    } else if(squad[i]) {
                        squad[i] = null;
                        renderPitch();
                    }
                };
                pitch.appendChild(div);
            });
        }

        function setPhase(p) {
            currentPhase = p;
            document.getElementById('btn-toplu').className = p === 'toplu' ? 'btn-active text-[10px] font-bold px-4 py-2 rounded border border-gray-700' : 'text-[10px] font-bold px-4 py-2 rounded border border-gray-700';
            document.getElementById('btn-topsuz').className = p === 'topsuz' ? 'btn-active text-[10px] font-bold px-4 py-2 rounded border border-gray-700' : 'text-[10px] font-bold px-4 py-2 rounded border border-gray-700';
            renderPitch();
        }

        function addManual() {
            const name = document.getElementById('manName').value;
            if(name) {
                selectedPlayerData = { name, team: "Manuel", goals: "-", matches: "-" };
                alert("Oyuncu seçildi! Şimdi sahadaki bir mevkiye tıkla.");
                document.getElementById('manName').value = "";
            }
        }

        renderPitch();
    </script>
</body>
</html>
